# ADR-0003 受限管理员视图

状态：Accepted（MVP）
日期：2025-10-21

背景与动机
- 需要管理员角色以便进行设备/用户管理，但不允许管理员浏览具体照片内容或预览，提高隐私保护。

决策
- 可见范围：管理员仅可查看用户列表、设备绑定、每用户媒体计数、存储占用、同步状态统计。
- 禁止范围：管理员不可访问具体媒体文件、缩略图、相册内容、EXIF 细节与任何明文预览。
- 审计与日志：管理员操作（添加/移除用户、重置令牌、查看统计）需记录审计日志。
- 查询接口：提供聚合统计接口（按 user_id 维度聚合），输出不包含任何媒体标识与路径。

实现要点
- 权限模型：角色枚举（admin, user），UI与控制器根据角色切换视图与接口。
- 数据访问：所有数据查询默认携带 user_id；管理员视图使用聚合SQL（COUNT/AVG/SUM）且屏蔽细节字段。
- 安全测试：确保任何侧路（日志、错误信息、导出）不泄露内容。

取舍与影响
- 优点：最小可见原则，降低隐私风险。
- 代价：管理员排障能力下降；通过匿名化错误码与受限日志补足。
- 风险：实现细节遗漏导致越权；通过权限中间层与测试用例覆盖。

关联
- 里程碑：M2（注册与角色设定）、M5（浏览视图区分）、M8（审计与访问控制）