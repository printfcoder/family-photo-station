# M2 桌面库初始化与配对向导

目标
- 首启向导完成“库根路径选择+设备ID/令牌生成+局域网配对方式（扫码/发现）”，为同步打基础。

交付内容
- 向导 UI：欢迎页→库路径选择→生成设备ID与令牌→LAN 配对入口（二维码/发现）。
- 配置持久化：库根绝对路径、安全存储设备令牌（不明文）、可导出二维码。
- 配对机制：二维码包含设备ID与短期令牌；LAN 发现广播（可选，后续增强）。

验收标准
- 库路径选择与校验通过，持久化成功；不使用相对路径。
- 配对流程≤30秒（扫码→认证→配对状态确认）。
- 秘钥不明文持久化；令牌可轮换；无 station/backend 依赖。

约束与边界
- 局域网内配对；不做公网注册；移动端将在后续里程碑适配。

技术要点
- 二维码生成与解析；局域网发现（mDNS/UDP 广播占位）。
- 令牌生成与存储（加密存储/系统钥匙串，跨平台差异考虑）。
- 配置文件结构与版本（用于后续备份/恢复）。

风险与预案
- 跨平台二维码/存储兼容 → 选择跨平台库并验证。
- 局域网广播可靠性 → 提供扫码作为主路径，发现为辅助。

执行计划与进度快照
- 当前状态：pending
- 任务清单：
  - [ ] 向导 UI 与流程串联
  - [ ] 路径选择器与校验
  - [ ] 设备ID/令牌生成与保存
  - [ ] 二维码生成与配对确认页

依赖与关联
- 依赖：M1（架构与配置模块）；关联：M3（同步）、M7（备份）。

输出与交付物链接
- 代码位置：station/desktop/lib/modules/onboarding
- 文档链接：index.zh.md，MVP-scope.zh.md